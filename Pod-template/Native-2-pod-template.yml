apiVersion: v1
kind: Pod
metadata:
  name: jobmanager-pod-template
  namespace: default
spec:
  initContainers:
    - name: artifacts-fetcher
      image: artifacts-fetcher:latest
      # Use wget or other tools to get user jars from remote storage
      command: [ 'wget', '/home/midzdev1/flink/flink-standalone/flink-1.13.0/myindustry-flink-0.0.3-SNAPSHOT.jar', '-O', '/flink-artifact/myjob.jar' ]
      volumeMounts:
        - mountPath: /flink-artifact
          name: flink-artifact
  containers:
    # Do not change the main container name
    - name: flink-main-container
      image: rgmyindcamunda.azurecr.io/flink-standalone:v7
      resources:
        requests:
          ephemeral-storage: 2048Mi
        limits:
          ephemeral-storage: 2048Mi
      volumeMounts:
        - mountPath: /opt/flink/volumes/hostpath
          name: flink-volume-hostpath
        - mountPath: /opt/flink/artifacts
          name: flink-artifact
        - mountPath: /opt/flink/log
          name: flink-logs
      # Use sidecar container to push logs to remote storage or do some other debugging things
    #- name: sidecar-log-collector
      #image: sidecar-log-collector:latest
      #command: [ 'command-to-upload', '/home/midzdev1/flink/flink-standalone/flink-1.13.0/flink-logs/' ]
      #volumeMounts:
        #- mountPath: /flink-logs
          #name: flink-logs
    - name: filebeat-flink-manual
      image: rgmyindcamunda.azurecr.io/filebeat:7.5.0
      args: ["-c", "/etc/filebeat/filebeat_flink.yaml"]
      volumeMounts:
        - name:  filebeat-flink-manual-config
          mountPath: /etc/filebeat/
        - name:  flink-logs
          mountPath: /opt/flink/log
  volumes:
    - name: flink-volume-hostpath
      hostPath:
        path: /tmp
        type: Directory
    - name: flink-artifact
      emptyDir: { }
    #- name: flink-logs
      #emptyDir: { }
    - name: filebeat-flink-manual-config
      configMap:
         name: filebeat-flink-manual-config
         items:
           - key: filebeat_flink.yaml
             path: filebeat_flink.yaml
    - name: flink-logs
      emptyDir: {}